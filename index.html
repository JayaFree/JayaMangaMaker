<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JayaMangaMaker - AI Storyteller</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .neon-border { border: 2px solid #a855f7; box-shadow: 0 0 15px #a855f7; }
        .manga-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-5xl font-black text-center mb-10 text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600 uppercase tracking-tighter">
            Jaya Manga Maker
        </h1>
        
        <div class="manga-card p-6 rounded-2xl neon-border mb-8">
            <label class="block mb-2 text-purple-400 font-bold uppercase text-sm tracking-widest">Ton idée de Manga :</label>
            <textarea id="userPrompt" class="w-full bg-slate-900 p-4 rounded-xl border border-slate-700 focus:border-purple-500 outline-none text-white transition-all" rows="3" placeholder="Ex: Un chevalier de lumière affronte une ombre géante dans une forêt de cristal..."></textarea>
            <button onclick="generateManga()" id="btnGen" class="w-full mt-6 bg-purple-600 hover:bg-purple-500 text-white font-black py-4 rounded-xl shadow-lg shadow-purple-500/20 transform active:scale-95 transition-all">
                GÉNÉRER MON MANGA ANIMÉ
            </button>
        </div>

        <div id="player" class="hidden space-y-6 animate-fade-in">
            <div id="imageContainer" class="relative aspect-video rounded-2xl overflow-hidden neon-border bg-black group">
                <img id="sceneImage" src="" alt="Manga Scene" class="w-full h-full object-cover transition-opacity duration-1000">
                <div id="loader" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-80 text-white">
                    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500 mb-4"></div>
                    <p class="text-purple-400 font-mono italic" id="statusLabel">L'IA dessine ton histoire...</p>
                </div>
            </div>
            <div class="bg-slate-800 p-6 rounded-2xl border-l-4 border-purple-500 shadow-xl">
                <p id="narrationText" class="text-xl md:text-2xl italic leading-relaxed text-center text-purple-100"></p>
            </div>
        </div>
    </div>

    <script>
        // --- TA CLÉ API CI-DESSOUS ---
        const API_KEY = 'AIzaSyDfVlEQZNoJExU7c-L_HRRgBxj8AOpmGDg'; 

        async function generateManga() {
            const prompt = document.getElementById('userPrompt').value;
            if(!prompt) return alert("Donne-moi une idée d'abord !");
            
            setLoading(true, "Gemini écrit le script...");

            try {
                // 1. Demande au modèle Gemini de créer le script
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Tu es un scénariste de manga. Crée une histoire courte de 4 scènes basée sur : "${prompt}". Réponds UNIQUEMENT avec ce format JSON strict : [{"visual_prompt": "description visuelle détaillée en anglais", "narration": "texte court de narration en français"}]` }] }]
                    })
                });

                const data = await response.json();
                if(!data.candidates) throw new Error("Clé API invalide ou quota atteint.");
                
                let rawText = data.candidates[0].content.parts[0].text;
                const scenes = JSON.parse(rawText.replace(/```json|```/g, ''));

                playManga(scenes);
            } catch (error) {
                console.error(error);
                alert("Erreur : " + error.message);
                setLoading(false);
            }
        }

        function playManga(scenes) {
            document.getElementById('player').classList.remove('hidden');
            let current = 0;

            function showNextScene() {
                if (current >= scenes.length) {
                    setLoading(false);
                    document.getElementById('statusLabel').innerText = "Fin de l'histoire !";
                    return;
                }

                setLoading(true, `Génération de la scène ${current + 1}/4...`);
                const scene = scenes[current];
                
                // Préparation de l'URL Pollinations
                const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(scene.visual_prompt + ", high quality manga art style, cinematic lighting")}?width=1024&height=576&nologo=true&seed=${Math.floor(Math.random()*1000)}`;
                
                const img = document.getElementById('sceneImage');
                img.src = imgUrl;

                img.onload = () => {
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('narrationText').innerText = scene.narration;

                    // Lancement de la voix
                    const speech = new SpeechSynthesisUtterance(scene.narration);
                    speech.lang = 'fr-FR';
                    speech.rate = 0.9;
                    speech.onend = () => {
                        current++;
                        setTimeout(showNextScene, 1500);
                    };
                    window.speechSynthesis.speak(speech);
                };
            }

            showNextScene();
        }

        function setLoading(isLoading, message = "") {
            const btn = document.getElementById('btnGen');
            const loader = document.getElementById('loader');
            btn.disabled = isLoading;
            if(message) document.getElementById('statusLabel').innerText = message;
            if(isLoading) loader.classList.remove('hidden');
        }
    </script>
</body>
</html>
